<!-- AutoLogX/templates/service_records/form.html -->
{% extends 'base.html' %}
{% load widget_tweaks %}
{% block title %}{{ title }}{% endblock %}
{% block content %}
<div class="form-container">
    <h3>{{ title }}</h3>
    {% if vehicle %}
        <h5 class="mb-4">For: {{ vehicle.year }} {{ vehicle.make }} {{ vehicle.model }} (VIN: {{ vehicle.vin|default:"N/A" }})</h5>
    {% endif %}
    <!-- Important: Add enctype="multipart/form-data" for file uploads -->
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% if form.non_field_errors %}
            <div class="alert alert-danger">
                {{ form.non_field_errors }}
            </div>
        {% endif %}

        <!-- Service Type -->
        <div class="form-group">
            <label for="{{ form.service_type.id_for_label }}" class="form-label">{{ form.service_type.label }}</label>
            {{ form.service_type|add_class:"form-select" }}
            {% if form.service_type.errors %}
                <div class="invalid-feedback">
                    {{ form.service_type.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Date -->
        <div class="form-group">
            <label for="{{ form.date.id_for_label }}" class="form-label">{{ form.date.label }}</label>
            {{ form.date|add_class:"form-control" }}
            {% if form.date.errors %}
                <div class="invalid-feedback">
                    {{ form.date.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Mileage -->
        <div class="form-group">
            <label for="{{ form.mileage.id_for_label }}" class="form-label">{{ form.mileage.label }}</label>
            {{ form.mileage|add_class:"form-control" }}
            {% if form.mileage.errors %}
                <div class="invalid-feedback">
                    {{ form.mileage.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Cost -->
        <div class="form-group">
            <label for="{{ form.cost.id_for_label }}" class="form-label">{{ form.cost.label }}</label>
            <div class="input-group">
                <span class="input-group-text">$</span>
                {{ form.cost|add_class:"form-control" }}
            </div>
            {% if form.cost.errors %}
                <div class="invalid-feedback">
                    {{ form.cost.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Shop Name -->
        <div class="form-group">
            <label for="{{ form.shop_name.id_for_label }}" class="form-label">{{ form.shop_name.label }}</label>
            {{ form.shop_name|add_class:"form-control" }}
            {% if form.shop_name.errors %}
                <div class="invalid-feedback">
                    {{ form.shop_name.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Description -->
        <div class="form-group">
            <label for="{{ form.description.id_for_label }}" class="form-label">{{ form.description.label }}</label>
            {{ form.description|add_class:"form-control" }}
            {% if form.description.errors %}
                <div class="invalid-feedback">
                    {{ form.description.errors }}
                </div>
            {% endif %}
            <div class="form-text">Provide details about the service performed.</div>
        </div>

        <!-- Notes -->
        <div class="form-group">
            <label for="{{ form.notes.id_for_label }}" class="form-label">{{ form.notes.label }}</label>
            {{ form.notes|add_class:"form-control" }}
            {% if form.notes.errors %}
                <div class="invalid-feedback">
                    {{ form.notes.errors }}
                </div>
            {% endif %}
            <div class="form-text">Any additional notes or reminders.</div>
        </div>

        <!-- Next Service Date -->
        <div class="form-group">
            <label for="{{ form.next_service_date.id_for_label }}" class="form-label">{{ form.next_service_date.label }}</label>
            {{ form.next_service_date|add_class:"form-control" }}
            {% if form.next_service_date.errors %}
                <div class="invalid-feedback">
                    {{ form.next_service_date.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Next Service Mileage -->
        <div class="form-group">
            <label for="{{ form.next_service_mileage.id_for_label }}" class="form-label">{{ form.next_service_mileage.label }}</label>
            {{ form.next_service_mileage|add_class:"form-control" }}
            {% if form.next_service_mileage.errors %}
                <div class="invalid-feedback">
                    {{ form.next_service_mileage.errors }}
                </div>
            {% endif %}
        </div>

        <!-- Attachments -->
        <div class="form-group">
            <label for="{{ form.attachments.id_for_label }}" class="form-label">{{ form.attachments.label }}</label>
            <!-- Use widget_tweaks to add class -->
            {{ form.attachments|add_class:"form-control" }}
            {% if form.attachments.errors %}
                <div class="invalid-feedback">
                    {{ form.attachments.errors }}
                </div>
            {% endif %}
            {% if form.attachments.help_text %}
                <div class="form-text">{{ form.attachments.help_text }}</div>
            {% endif %}
        </div>

        <div class="d-grid gap-2 d-md-flex justify-content-md-end mt-4">
            <button type="submit" class="btn btn-primary me-md-2">Save Service Record</button>
            {% if vehicle %}
                <a href="{% url 'vehicle_detail' vehicle.pk %}" class="btn btn-secondary">Cancel</a>
            {% else %}
                <a href="{% url 'vehicle_list' %}" class="btn btn-secondary">Cancel</a>
            {% endif %}
        </div>
    </form>
</div>
{% endblock %}
